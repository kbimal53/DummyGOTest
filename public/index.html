<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go API Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="bg-gray-50 min-h-screen">
    <div x-data="apiDashboard()" class="container mx-auto px-4 py-8">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 flex items-center">
                        <i class="fas fa-server text-blue-600 mr-3"></i>
                        Go API Dashboard
                    </h1>
                    <p class="text-gray-600 mt-2">Manage users with your PostgreSQL-powered Go API</p>
                </div>
                <div class="flex items-center space-x-4">
                    <!-- API Status -->
                    <div class="flex items-center">
                        <div :class="apiStatus === 'healthy' ? 'bg-green-500' : 'bg-red-500'" 
                             class="w-3 h-3 rounded-full mr-2"></div>
                        <span class="text-sm font-medium" x-text="apiStatus === 'healthy' ? 'API Online' : 'API Offline'"></span>
                    </div>
                    <!-- Refresh Button -->
                    <button @click="checkApiHealth()" 
                            class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                        <i class="fas fa-sync-alt mr-2"></i>Refresh
                    </button>
                </div>
            </div>
        </div>

        <!-- API Health Check -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-heartbeat text-red-500 mr-2"></i>API Health Status
            </h2>
            <div x-show="healthData" class="grid grid-cols-1 md:grid-cols-3 gap-4">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-600 text-2xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Status</p>
                            <p class="font-semibold text-green-800" x-text="healthData?.data?.status || 'Unknown'"></p>
                        </div>
                    </div>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-database text-blue-600 text-2xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Database</p>
                            <p class="font-semibold text-blue-800" x-text="healthData?.data?.database || 'Unknown'"></p>
                        </div>
                    </div>
                </div>
                <div class="bg-purple-50 border border-purple-200 rounded-lg p-4">
                    <div class="flex items-center">
                        <i class="fas fa-clock text-purple-600 text-2xl mr-3"></i>
                        <div>
                            <p class="text-sm text-gray-600">Last Check</p>
                            <p class="font-semibold text-purple-800" x-text="formatTimestamp(healthData?.data?.timestamp)"></p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add User Form -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-xl font-semibold text-gray-800 mb-4">
                <i class="fas fa-user-plus text-green-600 mr-2"></i>Add New User
            </h2>
            <form @submit.prevent="createUser()" class="grid grid-cols-1 md:grid-cols-3 gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Name</label>
                    <input type="text" x-model="newUser.name" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Enter full name">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                    <input type="email" x-model="newUser.email" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           placeholder="Enter email address">
                </div>
                <div>
                    <button type="submit" :disabled="loading"
                            class="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50">
                        <i class="fas fa-plus mr-2"></i>
                        <span x-text="loading ? 'Adding...' : 'Add User'"></span>
                    </button>
                </div>
            </form>
        </div>

        <!-- Users List -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-users text-blue-600 mr-2"></i>
                    Users (<span x-text="users.length"></span>)
                </h2>
                <button @click="fetchUsers()" 
                        class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                    <i class="fas fa-refresh mr-2"></i>Reload
                </button>
            </div>

            <!-- Loading State -->
            <div x-show="loading" class="text-center py-8">
                <i class="fas fa-spinner fa-spin text-3xl text-blue-600 mb-4"></i>
                <p class="text-gray-600">Loading users...</p>
            </div>

            <!-- Users Table -->
            <div x-show="!loading && users.length > 0" class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Email</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Created</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <template x-for="user in users" :key="user.id">
                            <tr class="hover:bg-gray-50">
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="user.id"></td>
                                <td class="px-4 py-4 whitespace-nowrap">
                                    <div x-show="editingUser !== user.id">
                                        <span class="text-sm font-medium text-gray-900" x-text="user.name"></span>
                                    </div>
                                    <div x-show="editingUser === user.id">
                                        <input type="text" x-model="editUserData.name"
                                               class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
                                    </div>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap">
                                    <div x-show="editingUser !== user.id">
                                        <span class="text-sm text-gray-900" x-text="user.email"></span>
                                    </div>
                                    <div x-show="editingUser === user.id">
                                        <input type="email" x-model="editUserData.email"
                                               class="w-full px-2 py-1 border border-gray-300 rounded text-sm">
                                    </div>
                                </td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm text-gray-500" x-text="formatTimestamp(user.created)"></td>
                                <td class="px-4 py-4 whitespace-nowrap text-sm font-medium space-x-2">
                                    <div x-show="editingUser !== user.id" class="flex space-x-2">
                                        <button @click="startEditUser(user)"
                                                class="bg-yellow-600 text-white px-3 py-1 rounded hover:bg-yellow-700 transition-colors">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click="deleteUser(user.id)"
                                                class="bg-red-600 text-white px-3 py-1 rounded hover:bg-red-700 transition-colors">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                    <div x-show="editingUser === user.id" class="flex space-x-2">
                                        <button @click="updateUser(user.id)"
                                                class="bg-green-600 text-white px-3 py-1 rounded hover:bg-green-700 transition-colors">
                                            <i class="fas fa-check"></i>
                                        </button>
                                        <button @click="cancelEdit()"
                                                class="bg-gray-600 text-white px-3 py-1 rounded hover:bg-gray-700 transition-colors">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        </template>
                    </tbody>
                </table>
            </div>

            <!-- Empty State -->
            <div x-show="!loading && users.length === 0" class="text-center py-12">
                <i class="fas fa-users text-6xl text-gray-300 mb-4"></i>
                <h3 class="text-lg font-medium text-gray-900 mb-2">No users found</h3>
                <p class="text-gray-600 mb-4">Get started by adding your first user above.</p>
            </div>
        </div>

        <!-- Notifications -->
        <div x-show="notification" x-transition
             :class="notificationType === 'success' ? 'bg-green-500' : 'bg-red-500'"
             class="fixed top-4 right-4 text-white px-6 py-3 rounded-lg shadow-lg z-50">
            <span x-text="notification"></span>
        </div>
    </div>

    <script>
        function apiDashboard() {
            return {
                users: [],
                newUser: { name: '', email: '' },
                editingUser: null,
                editUserData: {},
                loading: false,
                notification: '',
                notificationType: 'success',
                apiStatus: 'unknown',
                healthData: null,
                apiBaseUrl: window.location.origin,

                init() {
                    this.checkApiHealth();
                    this.fetchUsers();
                },

                async checkApiHealth() {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/health`);
                        const data = await response.json();
                        this.apiStatus = response.ok ? 'healthy' : 'error';
                        this.healthData = data;
                    } catch (error) {
                        this.apiStatus = 'error';
                        this.showNotification('Error checking API health', 'error');
                    }
                },

                async fetchUsers() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/users`);
                        const data = await response.json();
                        if (data.success) {
                            this.users = data.data || [];
                        } else {
                            this.showNotification('Failed to fetch users', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error connecting to API', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                async createUser() {
                    this.loading = true;
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/users`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.newUser)
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.users.push(data.data);
                            this.newUser = { name: '', email: '' };
                            this.showNotification('User created successfully!', 'success');
                        } else {
                            this.showNotification(data.message || 'Failed to create user', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error creating user', 'error');
                    } finally {
                        this.loading = false;
                    }
                },

                startEditUser(user) {
                    this.editingUser = user.id;
                    this.editUserData = { name: user.name, email: user.email };
                },

                async updateUser(userId) {
                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/users/${userId}`, {
                            method: 'PUT',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(this.editUserData)
                        });
                        const data = await response.json();
                        if (data.success) {
                            const userIndex = this.users.findIndex(u => u.id === userId);
                            if (userIndex !== -1) {
                                this.users[userIndex] = data.data;
                            }
                            this.editingUser = null;
                            this.showNotification('User updated successfully!', 'success');
                        } else {
                            this.showNotification(data.message || 'Failed to update user', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error updating user', 'error');
                    }
                },

                cancelEdit() {
                    this.editingUser = null;
                    this.editUserData = {};
                },

                async deleteUser(userId) {
                    if (!confirm('Are you sure you want to delete this user?')) return;

                    try {
                        const response = await fetch(`${this.apiBaseUrl}/api/users/${userId}`, {
                            method: 'DELETE'
                        });
                        const data = await response.json();
                        if (data.success) {
                            this.users = this.users.filter(u => u.id !== userId);
                            this.showNotification('User deleted successfully!', 'success');
                        } else {
                            this.showNotification(data.message || 'Failed to delete user', 'error');
                        }
                    } catch (error) {
                        this.showNotification('Error deleting user', 'error');
                    }
                },

                showNotification(message, type = 'success') {
                    this.notification = message;
                    this.notificationType = type;
                    setTimeout(() => {
                        this.notification = '';
                    }, 3000);
                },

                formatTimestamp(timestamp) {
                    if (!timestamp) return 'N/A';
                    return new Date(timestamp).toLocaleString();
                }
            }
        }
    </script>
</body>
</html>
